(()=>{"use strict";const e=[{type:"number",key:"numOfIcons",label:"Number of Icons",input:"true"},{type:"textfield",key:"filledColor",label:"Filled Color",input:"true"},{type:"textfield",key:"unfilledColor",label:"UnFilled Color",input:"true"},{type:"textfield",key:"iconHeight",label:"Icon Height",input:"true"},{type:"textfield",key:"iconWidth",label:"Icon Width",input:"true"},{type:"textarea",key:"icon",label:"Icon",input:!0},{key:"placeholder",ignore:!0}];function t(...t){return Formio.Components.baseEditForm([{key:"data",ignore:!0},{key:"display",components:e},{key:"validation",ignore:!0}],...t)}const o=Formio.Components.components.field;class n extends o{static editForm=t;static schema(...e){return o.schema({type:"rating",label:"rating",key:"rating",unfilledColor:"#ddd",filledColor:"yellow",numOfIcons:"5",iconHeight:"25px",iconWidth:"25px",icon:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n                 \t viewBox="0 0 47.94 47.94" xml:space="preserve">\n                 <path d="M26.285,2.486l5.407,10.956c0.376,0.762,1.103,1.29,1.944,1.412l12.091,1.757\n                 \tc2.118,0.308,2.963,2.91,1.431,4.403l-8.749,8.528c-0.608,0.593-0.886,1.448-0.742,2.285l2.065,12.042\n                 \tc0.362,2.109-1.852,3.717-3.746,2.722l-10.814-5.685c-0.752-0.395-1.651-0.395-2.403,0l-10.814,5.685\n                 \tc-1.894,0.996-4.108-0.613-3.746-2.722l2.065-12.042c0.144-0.837-0.134-1.692-0.742-2.285l-8.749-8.528\n                 \tc-1.532-1.494-0.687-4.096,1.431-4.403l12.091-1.757c0.841-0.122,1.568-0.65,1.944-1.412l5.407-10.956\n                 \tC22.602,0.567,25.338,0.567,26.285,2.486z"/>\n            </svg>'})}static get builderInfo(){return{title:"Rating",icon:"star",group:"basic",documentation:"/userguide/#textfield",weight:0,schema:n.schema()}}setIconProperties(){const e=(new DOMParser).parseFromString(this.component.icon,"text/xml");e.firstChild.style.fill=this.component.unfilledColor,e.firstChild.setAttribute("height",this.component.iconHeight),e.firstChild.setAttribute("width",this.component.iconWidth),this.component.icon=(new XMLSerializer).serializeToString(e.documentElement)}constructor(e,t,o){super(e,t,o)}init(){this.setIconProperties(),super.init()}get inputInfo(){return super.inputInfo}render(e){let t='<div ref="rating">';for(let e=0;e<this.component.numOfIcons;e++)t+=this.component.icon;return t+="</div>",super.render(t)}attach(e){function t(e,t){for(const o of e)o.style.fill=t}if(this.loadRefs(e,{rating:"single"}),!this.component.disabled){let e=this.refs.rating.children;for(let o=0;o<e.length;o++){let n=e[o];n.addEventListener("click",(()=>{t(e,this.component.unfilledColor),n.style.fill=this.component.filledColor;let r=n.previousElementSibling;for(;r;)r.style.fill=this.component.filledColor,r=r.previousElementSibling;this.updateValue(`${o+1}/${e.length}`)}))}}return super.attach(e)}detach(){return super.detach()}destroy(){return super.destroy()}normalizeValue(e,t={}){return super.normalizeValue(e,t)}getValue(){return super.getValue()}getValueAt(e){return super.getValueAt(e)}setValue(e,t={}){return super.setValue(e,t)}setValueAt(e,t,o={}){return super.setValueAt(e,t,o)}updateValue(e,t={}){return super.updateValue(e,t)}}const r=[{type:"textfield",key:"storeChangeBtnLabel",label:"Store Change Button Label",input:"true"},{type:"textfield",key:"storeInitialBtnLabel",label:"Store Initial Button Label",input:"true"},{type:"textfield",key:"storeClearBtnLabel",label:"Store Clear Button Label",input:"true"}];function s(...e){return Formio.Components.baseEditForm([{key:"data",ignore:!0},{key:"display",components:r},{key:"validation",ignore:!0}],...e)}const i=Formio.Components.components.field;class a extends i{static editForm=s;static Version="0.0.34-alpha";static StoreLocatorEvents={StoreSelected:"store.selected",StoreChanged:"store.changed",StoreSearch:"store.search",StoreSearchResults:"store.search.results"};static LocalStorageKeys={MageCacheStorage:"mage-cache-storage",AllFranchisees:"all-franchisees"};static MageCacheStorageKeys={StoreLocation:"store-location"};static Palette={Primary:{Main:"#3e87cb"},Grey:{Main:"#F7F8F8",Text:"#63666A"},Warning:{Main:"#6F4400"},White:"#ffffff"};static Styles={Container:{"background-color":a.Palette.Grey.Main,padding:"0px 12px","border-radius":"8px",display:"flex","flex-direction":"row",position:"relative",gap:"8px"},IconContainer:{display:"none","align-items":"center"},Input:{outline:"none",border:"none",background:"transparent","flex-grow":1,color:a.Palette.Grey.Text,"box-shadow":"none !important"},StoreChangeBtn:{color:a.Palette.Primary.Main,display:"flex",cursor:"pointer","align-items":"center"},DropdownContainer:{position:"absolute",top:"calc(100% + 10px)","background-color":a.Palette.White,width:"100%",left:0,"z-index":100,"border-radius":"8px",padding:"12px","box-shadow":"0px 4px 12px rgba(0,0,0,0.25)",display:"none","flex-direction":"column",gap:"8px","max-height":"200px",overflow:"auto"},DropdownItem:{color:a.Palette.Primary.Main,"text-decoration":"underline",cursor:"pointer"},NoMatchingStoresContainer:{border:`2px solid ${a.Palette.Warning.Main}`,"border-radius":"8px",padding:"12px",margin:"4px",display:"flex","align-items":"center",gap:"8px"},WarningIcon:{display:"flex","flex-shrink":"0",width:"24px",height:"24px"},WarningMessageText:{color:a.Palette.Warning.Main,"font-size":"12px","font-weight":"500","line-height":"1.4"},UseCurrentLocationContainer:{display:"flex","align-items":"center",gap:"8px",padding:"4px 0px",cursor:"pointer"},UseCurrentLocationText:{color:a.Palette.Primary.Main,"font-size":"14px","font-weight":"600","line-height":"120%","letter-spacing":"0%","text-decoration":"underline","text-decoration-style":"solid"},UseCurrentLocationIcon:{display:"flex","flex-shrink":"0",width:"24px",height:"24px"}};static schema(...e){return i.schema({type:"storeLocator",label:"Store Locator",key:"storeLocator",storeChangeBtnLabel:"Change",storeInitialBtnLabel:"Use my current location",storeClearBtnLabel:"Clear"})}static get builderInfo(){return{title:"Store Locator",icon:"map",group:"basic",documentation:"/userguide/#textfield",weight:0,schema:a.schema()}}constructor(e,t,o){super(e,t,o)}init(){super.init()}get inputInfo(){return super.inputInfo}render(e){const t=a.stylesToCssString(a.Styles.Input),o=a.stylesToCssString(a.Styles.Container),n=a.stylesToCssString(a.Styles.DropdownContainer),r=a.stylesToCssString(a.Styles.StoreChangeBtn);let s=`\n    <div ref="storeLocator" style="${o}">\n      <span ref="iconContainer" style="${a.stylesToCssString(a.Styles.IconContainer)}">\n        <svg width="24" height="24" viewBox="0 0 24 24" style="fill: #0BAE1A" xmlns="http://www.w3.org/2000/svg">\n          <mask id="mask0_64_3413" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">\n            <rect y="-7.62939e-06" width="24" height="24" fill="#0BAE1A"/>\n          </mask>\n          <g mask="url(#mask0_64_3413)">\n            <path d="M10.6 13.8L8.425 11.625C8.24167 11.4417 8.01667 11.35 7.75 11.35C7.48333 11.35 7.25 11.45 7.05 11.65C6.86667 11.8333 6.775 12.0667 6.775 12.35C6.775 12.6333 6.86667 12.8667 7.05 13.05L9.9 15.9C10.0833 16.0833 10.3167 16.175 10.6 16.175C10.8833 16.175 11.1167 16.0833 11.3 15.9L16.975 10.225C17.1583 10.0417 17.25 9.81666 17.25 9.54999C17.25 9.28333 17.15 9.04999 16.95 8.84999C16.7667 8.66666 16.5333 8.57499 16.25 8.57499C15.9667 8.57499 15.7333 8.66666 15.55 8.84999L10.6 13.8ZM12 22C10.6167 22 9.31667 21.7373 8.1 21.212C6.88333 20.6873 5.825 19.975 4.925 19.075C4.025 18.175 3.31267 17.1167 2.788 15.9C2.26267 14.6833 2 13.3833 2 12C2 10.6167 2.26267 9.31666 2.788 8.09999C3.31267 6.88333 4.025 5.82499 4.925 4.92499C5.825 4.02499 6.88333 3.31233 8.1 2.78699C9.31667 2.26233 10.6167 1.99999 12 1.99999C13.3833 1.99999 14.6833 2.26233 15.9 2.78699C17.1167 3.31233 18.175 4.02499 19.075 4.92499C19.975 5.82499 20.6873 6.88333 21.212 8.09999C21.7373 9.31666 22 10.6167 22 12C22 13.3833 21.7373 14.6833 21.212 15.9C20.6873 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6873 15.9 21.212C14.6833 21.7373 13.3833 22 12 22Z" fill="#0BAE1A"/>\n          </g>\n        </svg>\n      </span>\n      <input ref="storeInput" placeholder="${this.component.placeholder||"Search for a store"}" style="${t}"/>\n      <span ref="storeChangeBtn" style="${r}">${this.component.storeInitialBtnLabel||"Use my current location"}</span>\n      <div ref="dropdownContainer" style="${n}"></div>\n    </div>\n    `;return super.render(s)}static stylesToCssString(e,t={}){return Object.entries({...e,...t}).reduce(((e,[t,o])=>[e,`${t}: ${o}`].join("; ")),"")}getStoreFromLocalStorage(){const e=localStorage.getItem(a.LocalStorageKeys.MageCacheStorage);if(!e)return null;const t=JSON.parse(e)[a.MageCacheStorageKeys.StoreLocation];return t&&t.id?t:null}getAllFranchiseesFromLocalStorage(){try{const e=localStorage.getItem(a.LocalStorageKeys.AllFranchisees);return e?JSON.parse(e):[]}catch(e){return console.error({message:"Error reading franchisees from localStorage",error:e.message}),[]}}getFranchiseeByStoreId(e,t){if(!t||0===t.length)return null;const o=t.find((t=>t.storeId===e||t.store_id===e));return o?console.log("~~~ Found franchisee for storeId:",e,o):console.log("~~~ No franchisee found for storeId:",e),o||null}attach(e){this.loadRefs(e,{storeLocator:"single",dropdownContainer:"single",storeInput:"single",storeChangeBtn:"single",iconContainer:"single"});const t=this;let o=!1,n=t.getAllFranchiseesFromLocalStorage();if(this.component.disabled)return;this._eventHandlers=this._eventHandlers||{};const r=this.refs.storeInput,s=this.refs.dropdownContainer,i=this.refs.storeChangeBtn,l=this.refs.iconContainer,c=()=>{s.style=a.stylesToCssString(a.Styles.DropdownContainer,{display:"flex"})},d=()=>{s.style=a.stylesToCssString({display:"none"})},u=()=>{l.style=a.stylesToCssString({display:"none"})},p=()=>{const e=r.value&&""!==r.value.trim();i.innerText=e?o?t.component.storeChangeBtnLabel||"Change":t.component.storeClearBtnLabel||"Clear":t.component.storeInitialBtnLabel||"Use my current location"},g=e=>{const n=e.name;n&&(r.value=n,o=!0,i.style=a.stylesToCssString(a.Styles.StoreChangeBtn,{display:"flex"}),d(),l.style=a.stylesToCssString(a.Styles.IconContainer,{display:"flex"}),t.updateValue(n),p())};(()=>{const e=t.getStoreFromLocalStorage();if(!e)return void p();const o=e.id||e.store_id,r=t.getFranchiseeByStoreId(o,n);if(r){const e=r.bmqFormType||r.bmq_form_type;t.updateStoreFormTypeField(e)}else console.warn("⚠️ No franchisee found for cached store:",o);g(e)})();const h=()=>{for(;s.firstChild;)s.removeChild(s.firstChild)},m=e=>{const t=document.createElement("div");t.style=a.stylesToCssString(a.Styles.NoMatchingStoresContainer);const o=document.createElement("span");o.innerHTML='\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <mask id="mask0_1002_39163" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">\n            <rect width="24" height="24" fill="#D9D9D9"/>\n          </mask>\n          <g mask="url(#mask0_1002_39163)">\n            <path d="M2.72187 21C2.33854 21 2.05521 20.8333 1.87188 20.5C1.68854 20.1667 1.68854 19.8333 1.87188 19.5L11.1219 3.5C11.3052 3.16667 11.5969 3 11.9969 3C12.3969 3 12.6885 3.16667 12.8719 3.5L22.1219 19.5C22.3052 19.8333 22.3052 20.1667 22.1219 20.5C21.9385 20.8333 21.6552 21 21.2719 21H2.72187ZM11.9969 10C11.7135 10 11.4762 10.0957 11.2849 10.287C11.0929 10.479 10.9969 10.7167 10.9969 11V14C10.9969 14.2833 11.0929 14.5207 11.2849 14.712C11.4762 14.904 11.7135 15 11.9969 15C12.2802 15 12.5179 14.904 12.7099 14.712C12.9012 14.5207 12.9969 14.2833 12.9969 14V11C12.9969 10.7167 12.9012 10.479 12.7099 10.287C12.5179 10.0957 12.2802 10 11.9969 10ZM11.9969 18C12.2802 18 12.5179 17.904 12.7099 17.712C12.9012 17.5207 12.9969 17.2833 12.9969 17C12.9969 16.7167 12.9012 16.4793 12.7099 16.288C12.5179 16.096 12.2802 16 11.9969 16C11.7135 16 11.4762 16.096 11.2849 16.288C11.0929 16.4793 10.9969 16.7167 10.9969 17C10.9969 17.2833 11.0929 17.5207 11.2849 17.712C11.4762 17.904 11.7135 18 11.9969 18Z" fill="#6F4400"/>\n          </g>\n        </svg>\n      ',o.style=a.stylesToCssString(a.Styles.WarningIcon);const n=document.createElement("span");return n.innerText=e,n.style=a.stylesToCssString(a.Styles.WarningMessageText),t.appendChild(o),t.appendChild(n),t},y=()=>{if(r.value="Searching for nearby stores...",r.disabled=!0,d(),navigator.geolocation)navigator.geolocation.getCurrentPosition((function(e){const o=e.coords.latitude,i=e.coords.longitude;console.log("~~~ User location:",{userLat:o,userLng:i}),fetch(`https://api.bigdatacloud.net/data/reverse-geocode-client?latitude=${o}&longitude=${i}&localityLanguage=en`).then((e=>e.json())).then((e=>{console.log("~~~ Reverse geocoding response:",e);const o=e.postcode||e.postalCode;if(!o){console.error("~~~ No postcode found in geocoding response:",o),r.value="",r.disabled=!1,c(),h();const e=m("We couldn't determine your postcode. Please enter your postcode manually.");return void s.appendChild(e)}console.log("~~~ User postcode:",o),t.dispatchStoreSearchEvent(o);const i=e=>{const l=e.detail.stores;if(!l||0===l.length){console.log("~~~ No stores found for postcode:",o),r.value="",r.disabled=!1,c(),h();const e=m("We didn't find any store matching your postcode. Please re-enter your postcode or suburb.");return s.appendChild(e),window.removeEventListener(a.StoreLocatorEvents.StoreSearchResults,i),void window.removeEventListener(a.StoreLocatorEvents.StoreSearch,i)}const d=l.filter((e=>(e.zip||e.postcode)===o));if(0===d.length){console.log("~~~ No stores with exact postcode match:",o),r.value="",r.disabled=!1,c(),h();const e=m("We didn't find any store matching your postcode. Please re-enter your postcode or suburb.");return s.appendChild(e),window.removeEventListener(a.StoreLocatorEvents.StoreSearchResults,i),void window.removeEventListener(a.StoreLocatorEvents.StoreSearch,i)}if(1===d.length){const e=d[0];console.log("~~~ Auto-selecting store:",e);const o=e.id||e.store_id,r=t.getFranchiseeByStoreId(o,n);if(r){const o=r.bmqFormType||r.bmq_form_type;e.bmq_form_type=o,e.bmqFormType=o,t.updateStoreFormTypeField(o)}return g(e),t.setLocalStorage(e),t.dispatchStoreSelectedEvent(e),window.removeEventListener(a.StoreLocatorEvents.StoreSearchResults,i),void window.removeEventListener(a.StoreLocatorEvents.StoreSearch,i)}console.log("~~~ Multiple stores in postcode:",o,d),r.value="",r.disabled=!1,S(d),window.removeEventListener(a.StoreLocatorEvents.StoreSearchResults,i),window.removeEventListener(a.StoreLocatorEvents.StoreSearch,i)};window.addEventListener(a.StoreLocatorEvents.StoreSearchResults,i),window.addEventListener(a.StoreLocatorEvents.StoreSearch,i)})).catch((e=>{console.error("~~~ Reverse geocoding error:",e),r.value="",r.disabled=!1,c(),h();const t=m("We couldn't determine your postcode. Please enter your postcode manually.");s.appendChild(t)}))}),(function(e){console.error("Geolocation error:",e);let t="";switch(e.code){case e.PERMISSION_DENIED:t="Location access was denied. Please enable location permissions or enter your postcode manually.";break;case e.POSITION_UNAVAILABLE:t="Location information is unavailable. Please enter your postcode manually.";break;case e.TIMEOUT:t="Location request timed out. Please try again or enter your postcode manually.";break;default:t="An error occurred while getting your location. Please enter your postcode manually."}r.value="",r.disabled=!1,c(),h();const o=m(t);s.appendChild(o)}),{enableHighAccuracy:!0,timeout:1e4,maximumAge:0});else{console.error("Geolocation is not supported by this browser"),r.value="",r.disabled=!1,c(),h();const e=m("Geolocation is not supported by your browser. Please enter your postcode manually.");s.appendChild(e)}},S=e=>{if(console.log("~~~ stores from filter and display stores",e),c(),h(),0===e.length){const e=m("We didn't find any store matching the provided postcode/suburb. Please re-enter your postcode or suburb.");s.appendChild(e)}else{const o=e.map((e=>(e=>{const o=document.createElement("div"),r=document.createElement("a");return r.innerText=e.name,r.addEventListener("click",(function(o){o.preventDefault(),o.stopPropagation(),g(e);const r=e.id||e.store_id,s=t.getFranchiseeByStoreId(r,n);if(s){const o=s.bmqFormType||s.bmq_form_type;e.bmq_form_type=o,e.bmqFormType=o,t.updateStoreFormTypeField(o)}else console.warn("⚠️ No franchisee found for store:",r);t.setLocalStorage(e),t.dispatchStoreSelectedEvent(e)})),r.style=a.stylesToCssString(a.Styles.DropdownItem),o.appendChild(r),o})(e)));s.append(...o)}const o=(()=>{const e=document.createElement("div");e.style=a.stylesToCssString(a.Styles.UseCurrentLocationContainer);const t=document.createElement("span");t.innerHTML='\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <mask id="mask0_1002_39126" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">\n            <rect width="24" height="24" fill="#D9D9D9"/>\n          </mask>\n          <g mask="url(#mask0_1002_39126)">\n            <path fill-rule="evenodd" clip-rule="evenodd" d="M14.5288 3.68905C15.9434 2.59894 17.9688 3.76833 17.732 5.53841L16.0027 18.4649C15.7502 20.3524 13.2523 20.8523 12.2928 19.2074L9.987 15.2545L5.41076 15.2341C3.50647 15.2256 2.69046 12.8124 4.19882 11.6499L14.5288 3.68905ZM14.0204 18.1997L15.7497 5.27321L5.41966 13.2341L9.99591 13.2545C10.7041 13.2576 11.3578 13.635 11.7146 14.2468L14.0204 18.1997Z" fill="#3E87CB"/>\n          </g>\n        </svg>\n      ',t.style=a.stylesToCssString(a.Styles.UseCurrentLocationIcon);const o=document.createElement("span");return o.innerText="Use my current location",o.style=a.stylesToCssString(a.Styles.UseCurrentLocationText),e.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation(),y()})),e.appendChild(t),e.appendChild(o),e})();s.appendChild(o)};return i.addEventListener("click",(function(e){e.preventDefault(),e.stopPropagation();const n=i.innerText,s=t.component.storeClearBtnLabel||"Clear",a=t.component.storeInitialBtnLabel||"Use my current location";if(n===s)return r.value="",o=!1,p(),d(),void u();if(n===a)return void y();const l=t.getStoreFromLocalStorage();r.value="",o=!1,u(),r.focus();const c=l&&(l.zip||l.postcode)||"";t.dispatchStoreSearchEvent(c),p()})),r.addEventListener("input",(function(e){const n=e.target.value;t.userInput=n,o=!1,p(),t.getValue()!==n&&u(),t.dispatchStoreSearchEvent(n)})),this._eventHandlers.StoreSearchResults=e=>{console.log("~~~ StoreSearchResults:",e.detail);const t=e.detail.stores;S(t)},window.addEventListener(a.StoreLocatorEvents.StoreSearchResults,this._eventHandlers.StoreSearchResults),super.attach(e)}dispatchStoreSearchEvent(e){const t={detail:{postCode:e}},o=new window.CustomEvent(a.StoreLocatorEvents.StoreSearch,t);window.dispatchEvent(o)}setLocalStorage(e){try{const t=e.store_id||e.id,o=localStorage.getItem(a.LocalStorageKeys.MageCacheStorage);let n=o?JSON.parse(o):{};n[a.MageCacheStorageKeys.StoreLocation]={...e,id:t},localStorage.setItem(a.LocalStorageKeys.MageCacheStorage,JSON.stringify(n))}catch(e){console.error({message:"Error setting store in localStorage",error:e.message})}}dispatchStoreSelectedEvent(e){console.log("~~~ dispatching store selected event",e);const t={detail:{storeId:e.store_id||e.id,bmqFormType:e.bmq_form_type||e.bmqFormType,store:e}};console.log("~~~ Final payload for store.selected event:",t);const o=new window.CustomEvent(a.StoreLocatorEvents.StoreSelected,t);window.dispatchEvent(o)}updateStoreFormTypeField(e){try{const t=this.root;if(!t)return void console.warn("StoreLocator: No root form found");const o=t.getComponent("storeFormType");o&&e&&o.setValue(e)}catch(e){console.error({message:"Error updating form fields",error:e})}}detach(){return this._eventHandlers&&this._eventHandlers.StoreSearchResults&&window.removeEventListener(a.StoreLocatorEvents.StoreSearchResults,this._eventHandlers.StoreSearchResults),super.detach()}destroy(){return this._eventHandlers&&(this._eventHandlers.StoreSearchResults&&window.removeEventListener(a.StoreLocatorEvents.StoreSearchResults,this._eventHandlers.StoreSearchResults),this._eventHandlers=null),super.destroy()}normalizeValue(e,t={}){return super.normalizeValue(e,t)}getValue(){return super.getValue()}getValueAt(e){return super.getValueAt(e)}setValue(e,t={}){return super.setValue(e,t)}setValueAt(e,t,o={}){return super.setValueAt(e,t,o)}updateValue(e,t={}){return super.updateValue(e,t)}checkCondition(e,t){return super.checkCondition(e,t)}checkConditions(e){return super.checkConditions(e)}set visible(e){super.visible=e}get visible(){return super.visible}}Formio.use([{components:{rating:n,storeLocator:a}}])})();