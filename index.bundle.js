(()=>{"use strict";const e=[{type:"number",key:"numOfIcons",label:"Number of Icons",input:"true"},{type:"textfield",key:"filledColor",label:"Filled Color",input:"true"},{type:"textfield",key:"unfilledColor",label:"UnFilled Color",input:"true"},{type:"textfield",key:"iconHeight",label:"Icon Height",input:"true"},{type:"textfield",key:"iconWidth",label:"Icon Width",input:"true"},{type:"textarea",key:"icon",label:"Icon",input:!0},{key:"placeholder",ignore:!0}];function t(...t){return Formio.Components.baseEditForm([{key:"data",ignore:!0},{key:"display",components:e},{key:"validation",ignore:!0}],...t)}const o=Formio.Components.components.field;class r extends o{static editForm=t;static schema(...e){return o.schema({type:"rating",label:"rating",key:"rating",unfilledColor:"#ddd",filledColor:"yellow",numOfIcons:"5",iconHeight:"25px",iconWidth:"25px",icon:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n                 \t viewBox="0 0 47.94 47.94" xml:space="preserve">\n                 <path d="M26.285,2.486l5.407,10.956c0.376,0.762,1.103,1.29,1.944,1.412l12.091,1.757\n                 \tc2.118,0.308,2.963,2.91,1.431,4.403l-8.749,8.528c-0.608,0.593-0.886,1.448-0.742,2.285l2.065,12.042\n                 \tc0.362,2.109-1.852,3.717-3.746,2.722l-10.814-5.685c-0.752-0.395-1.651-0.395-2.403,0l-10.814,5.685\n                 \tc-1.894,0.996-4.108-0.613-3.746-2.722l2.065-12.042c0.144-0.837-0.134-1.692-0.742-2.285l-8.749-8.528\n                 \tc-1.532-1.494-0.687-4.096,1.431-4.403l12.091-1.757c0.841-0.122,1.568-0.65,1.944-1.412l5.407-10.956\n                 \tC22.602,0.567,25.338,0.567,26.285,2.486z"/>\n            </svg>'})}static get builderInfo(){return{title:"Rating",icon:"star",group:"basic",documentation:"/userguide/#textfield",weight:0,schema:r.schema()}}setIconProperties(){const e=(new DOMParser).parseFromString(this.component.icon,"text/xml");e.firstChild.style.fill=this.component.unfilledColor,e.firstChild.setAttribute("height",this.component.iconHeight),e.firstChild.setAttribute("width",this.component.iconWidth),this.component.icon=(new XMLSerializer).serializeToString(e.documentElement)}constructor(e,t,o){super(e,t,o)}init(){this.setIconProperties(),super.init()}get inputInfo(){return super.inputInfo}render(e){let t='<div ref="rating">';for(let e=0;e<this.component.numOfIcons;e++)t+=this.component.icon;return t+="</div>",super.render(t)}attach(e){function t(e,t){for(const o of e)o.style.fill=t}if(this.loadRefs(e,{rating:"single"}),!this.component.disabled){let e=this.refs.rating.children;for(let o=0;o<e.length;o++){let r=e[o];r.addEventListener("click",(()=>{t(e,this.component.unfilledColor),r.style.fill=this.component.filledColor;let n=r.previousElementSibling;for(;n;)n.style.fill=this.component.filledColor,n=n.previousElementSibling;this.updateValue(`${o+1}/${e.length}`)}))}}return super.attach(e)}detach(){return super.detach()}destroy(){return super.destroy()}normalizeValue(e,t={}){return super.normalizeValue(e,t)}getValue(){return super.getValue()}getValueAt(e){return super.getValueAt(e)}setValue(e,t={}){return super.setValue(e,t)}setValueAt(e,t,o={}){return super.setValueAt(e,t,o)}updateValue(e,t={}){return super.updateValue(e,t)}}const n=[{type:"textfield",key:"storeChangeBtnLabel",label:"Store Change Button Label",input:"true"},{type:"textfield",key:"storeInitialBtnLabel",label:"Store Initial Button Label",input:"true"},{type:"textfield",key:"storeClearBtnLabel",label:"Store Clear Button Label",input:"true"}];function s(...e){return Formio.Components.baseEditForm([{key:"data",ignore:!0},{key:"display",components:n},{key:"validation",ignore:!0}],...e)}const a=Formio.Components.components.field;class i extends a{static editForm=s;static Version="0.0.28-alpha";static StoreLocatorEvents={StoreSelected:"store.selected",StoreChanged:"store.changed",StoreSearch:"store.search",StoreSearchResults:"store.search.results"};static FranchiseeEvents={FranchiseeFetched:"franchisee.fetched"};static LocalStorageKeys={MageCacheStorage:"mage-cache-storage",AllFranchisees:"all-franchisees"};static MageCacheStorageKeys={StoreLocation:"store-location"};static Palette={Primary:{Main:"#3e87cb"},Grey:{Main:"#F7F8F8",Text:"#63666A"},White:"#ffffff"};static Styles={Container:{"background-color":i.Palette.Grey.Main,padding:"12px","border-radius":"8px",display:"flex","flex-direction":"row",position:"relative",gap:"8px"},IconContainer:{display:"none","align-items":"center"},Input:{outline:"none",border:"none",background:"transparent","flex-grow":1,color:i.Palette.Grey.Text,"box-shadow":"none !important"},StoreChangeBtn:{color:i.Palette.Primary.Main,display:"flex",cursor:"pointer","align-items":"center"},DropdownContainer:{position:"absolute",top:"calc(100% + 10px)","background-color":i.Palette.White,width:"100%",left:0,"z-index":100,"border-radius":"8px",padding:"12px","box-shadow":"0px 4px 12px rgba(0,0,0,0.25)",display:"none","flex-direction":"column",gap:"8px","max-height":"200px",overflow:"auto"},DropdownItem:{color:i.Palette.Primary.Main,"text-decoration":"underline",cursor:"pointer"}};static schema(...e){return a.schema({type:"storeLocator",label:"Store Locator",key:"storeLocator",storeChangeBtnLabel:"Change",storeInitialBtnLabel:"Use my current location",storeClearBtnLabel:"Clear"})}static get builderInfo(){return{title:"Store Locator",icon:"map",group:"basic",documentation:"/userguide/#textfield",weight:0,schema:i.schema()}}constructor(e,t,o){super(e,t,o)}init(){super.init()}get inputInfo(){return super.inputInfo}render(e){const t=i.stylesToCssString(i.Styles.Input),o=i.stylesToCssString(i.Styles.Container),r=i.stylesToCssString(i.Styles.DropdownContainer),n=i.stylesToCssString(i.Styles.StoreChangeBtn);let s=`\n    <div ref="storeLocator" style="${o}">\n      <span ref="iconContainer" style="${i.stylesToCssString(i.Styles.IconContainer)}">\n        <svg width="24" height="24" viewBox="0 0 24 24" style="fill: #0BAE1A" xmlns="http://www.w3.org/2000/svg">\n          <mask id="mask0_64_3413" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">\n            <rect y="-7.62939e-06" width="24" height="24" fill="#0BAE1A"/>\n          </mask>\n          <g mask="url(#mask0_64_3413)">\n            <path d="M10.6 13.8L8.425 11.625C8.24167 11.4417 8.01667 11.35 7.75 11.35C7.48333 11.35 7.25 11.45 7.05 11.65C6.86667 11.8333 6.775 12.0667 6.775 12.35C6.775 12.6333 6.86667 12.8667 7.05 13.05L9.9 15.9C10.0833 16.0833 10.3167 16.175 10.6 16.175C10.8833 16.175 11.1167 16.0833 11.3 15.9L16.975 10.225C17.1583 10.0417 17.25 9.81666 17.25 9.54999C17.25 9.28333 17.15 9.04999 16.95 8.84999C16.7667 8.66666 16.5333 8.57499 16.25 8.57499C15.9667 8.57499 15.7333 8.66666 15.55 8.84999L10.6 13.8ZM12 22C10.6167 22 9.31667 21.7373 8.1 21.212C6.88333 20.6873 5.825 19.975 4.925 19.075C4.025 18.175 3.31267 17.1167 2.788 15.9C2.26267 14.6833 2 13.3833 2 12C2 10.6167 2.26267 9.31666 2.788 8.09999C3.31267 6.88333 4.025 5.82499 4.925 4.92499C5.825 4.02499 6.88333 3.31233 8.1 2.78699C9.31667 2.26233 10.6167 1.99999 12 1.99999C13.3833 1.99999 14.6833 2.26233 15.9 2.78699C17.1167 3.31233 18.175 4.02499 19.075 4.92499C19.975 5.82499 20.6873 6.88333 21.212 8.09999C21.7373 9.31666 22 10.6167 22 12C22 13.3833 21.7373 14.6833 21.212 15.9C20.6873 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6873 15.9 21.212C14.6833 21.7373 13.3833 22 12 22Z" fill="#0BAE1A"/>\n          </g>\n        </svg>\n      </span>\n      <input ref="storeInput" placeholder="${this.component.placeholder||"Search for a store"}" style="${t}"/>\n      <span ref="storeChangeBtn" style="${n}">${this.component.storeInitialBtnLabel||"Use my current location"}</span>\n      <div ref="dropdownContainer" style="${r}"></div>\n    </div>\n    `;return super.render(s)}static stylesToCssString(e,t={}){return Object.entries({...e,...t}).reduce(((e,[t,o])=>[e,`${t}: ${o}`].join("; ")),"")}getStoreFromLocalStorage(){const e=localStorage.getItem(i.LocalStorageKeys.MageCacheStorage);if(!e)return null;const t=JSON.parse(e)[i.MageCacheStorageKeys.StoreLocation];return t&&t.id?t:null}getAllFranchiseesFromLocalStorage(){try{const e=localStorage.getItem(i.LocalStorageKeys.AllFranchisees);if(!e)return console.log("~~~ No franchisees found in localStorage"),[];const t=JSON.parse(e);return console.log("~~~ Loaded franchisees from localStorage:",t.length),t}catch(e){return console.error({message:"Error reading franchisees from localStorage",error:e.message}),[]}}getFranchiseeByStoreId(e,t){if(!t||0===t.length)return console.log("~~~ No franchisees available to filter"),null;const o=t.find((t=>t.storeId===e||t.store_id===e));return o?console.log("~~~ Found franchisee for storeId:",e,o):console.log("~~~ No franchisee found for storeId:",e),o||null}attach(e){console.log("🔧 StoreLocator.attach() called - component ID:",this.id),this.loadRefs(e,{storeLocator:"single",dropdownContainer:"single",storeInput:"single",storeChangeBtn:"single",iconContainer:"single"});const t=this;let o=[],r=!1,n=t.getAllFranchiseesFromLocalStorage();if(console.log("🔧 StoreLocator: Loaded franchisees from consultant engine:",n.length),this.component.disabled)return;this._eventHandlers=this._eventHandlers||{};const s=this.refs.storeInput,a=this.refs.dropdownContainer,l=this.refs.storeChangeBtn,c=this.refs.iconContainer,d=()=>{a.style=i.stylesToCssString(i.Styles.DropdownContainer,{display:"flex"})},h=()=>{a.style=i.stylesToCssString({display:"none"})},u=()=>{c.style=i.stylesToCssString({display:"none"})},p=()=>{const e=s.value&&""!==s.value.trim();l.innerText=e?r?t.component.storeChangeBtnLabel||"Change":t.component.storeClearBtnLabel||"Clear":t.component.storeInitialBtnLabel||"Use my current location"},g=e=>{const o=e.name;o&&(s.value=o,r=!0,l.style=i.stylesToCssString(i.Styles.StoreChangeBtn,{display:"flex"}),h(),c.style=i.stylesToCssString(i.Styles.IconContainer,{display:"flex"}),t.updateValue(o),p())};(()=>{const e=t.getStoreFromLocalStorage();if(console.log("~~~ cacheStore from localStorage:",e),!e)return void p();const o=e.id||e.store_id;console.log("~~~ Enriching cached store with franchisee data for storeId:",o);const r=t.getFranchiseeByStoreId(o,n);if(r){console.log("~~~ Found franchisee for cached store:",r);const e=r.formType||r.form_type;t.updateStoreFormTypeField(e,o)}else console.warn("⚠️ No franchisee found for cached store:",o);g(e)})();const f=e=>{if(console.log("~~~ filtering stores for searchTerm:",e),!o||0===o.length)return;const r=o.filter((t=>{const o=t.name.toLowerCase(),r=e.toLowerCase();return o.includes(r)}));if(d(),(()=>{for(;a.firstChild;)a.removeChild(a.firstChild)})(),0===r.length){const e=document.createElement("div");e.innerText="No stores found",e.style="color: #666; padding: 8px;",a.appendChild(e)}else{const e=r.map((e=>(e=>{const o=document.createElement("div"),r=document.createElement("a");return r.innerText=e.name,r.addEventListener("click",(function(o){o.preventDefault(),o.stopPropagation(),g(e);const r=e.id||e.store_id;console.log("~~~ Store selected, looking up franchisee for storeId:",r);const s=t.getFranchiseeByStoreId(r,n);if(s){console.log("~~~ Enriching store with franchisee data:",s);const o=s.formType||s.form_type;e.form_type=o,e.formType=o,t.updateStoreFormTypeField(o,r)}else console.warn("⚠️ No franchisee found for store:",r);t.setLocalStorage(e),t.dispatchStoreSelectedEvent(e)})),r.style=i.stylesToCssString(i.Styles.DropdownItem),o.appendChild(r),o})(e)));a.append(...e)}};return l.addEventListener("click",(function(e){if(e.preventDefault(),e.stopPropagation(),l.innerText===(t.component.storeClearBtnLabel||"Clear"))return s.value="",r=!1,p(),h(),void u();s.focus(),r=!1;const n=t.getStoreFromLocalStorage(),a=t.userInput||n&&n.zip||"";t.dispatchStoreSearchEvent(a),o.length>0&&f(""),d(),u(),p()})),s.addEventListener("input",(function(e){const n=e.target.value;t.userInput=n,r=!1,p(),t.getValue()!==n&&u(),o&&o.length>0&&f(n),t.dispatchStoreSearchEvent(n)})),this._eventHandlers.storeSearch=e=>{console.log("~~~ inside store.search event listener (Magento direct)"),console.log("~~~ event.detail:",e.detail);const t=e.detail.stores;if(!t||0===t.length)return void console.log("~~~ No stores in event.detail");console.log("~~~ stores from Magento event:",t),o=t;const r=s.value||"";f(r)},window.addEventListener(i.StoreLocatorEvents.StoreSearch,this._eventHandlers.storeSearch),window.addEventListener(i.StoreLocatorEvents.StoreSearchResults,this._eventHandlers.storeSearch),window.addEventListener(i.FranchiseeEvents.FranchiseeFetched,this._eventHandlers.franchiseeFetched),super.attach(e)}dispatchStoreSearchEvent(e){const t={detail:{postCode:e}},o=new window.CustomEvent(i.StoreLocatorEvents.StoreSearch,t);window.dispatchEvent(o)}setLocalStorage(e){try{console.log("~~~ Setting store in localStorage",e);const t=e.store_id||e.id,o=localStorage.getItem(i.LocalStorageKeys.MageCacheStorage);let r=o?JSON.parse(o):{};r[i.MageCacheStorageKeys.StoreLocation]={...e,id:t},localStorage.setItem(i.LocalStorageKeys.MageCacheStorage,JSON.stringify(r)),console.log("✅ Store saved to localStorage:",r[i.MageCacheStorageKeys.StoreLocation])}catch(e){console.error({message:"Error setting store in localStorage",error:e.message})}}dispatchStoreSelectedEvent(e){console.log("~~~ dispatching store selected event",e);const t=e.store_id||e.id,o=e.form_type||e.formType;console.log("✅ Store enriched with formType:",o),console.log("✅ StoreId:",t);const r={detail:{storeId:t,formType:o,store:e}};console.log("✅ Final payload for store.selected event:",r);const n=new window.CustomEvent(i.StoreLocatorEvents.StoreSelected,r);window.dispatchEvent(n)}updateStoreFormTypeField(e,t){try{const t=this.root;if(!t)return void console.warn("StoreLocator: No root form found");const o=t.getComponent("storeFormType");o&&e&&(o.setValue(e),console.log("✅ Updated storeFormType to:",e))}catch(e){console.error({message:"Error updating form fields",error:e})}}detach(){return console.log("🧹 StoreLocator.detach() called - component ID:",this.id),this._eventHandlers&&(this._eventHandlers.storeSearch&&(window.removeEventListener(i.StoreLocatorEvents.StoreSearch,this._eventHandlers.storeSearch),window.removeEventListener(i.StoreLocatorEvents.StoreSearchResults,this._eventHandlers.storeSearch),console.log("✅ Removed storeSearch listeners")),this._eventHandlers.franchiseeFetched&&(window.removeEventListener(i.FranchiseeEvents.FranchiseeFetched,this._eventHandlers.franchiseeFetched),console.log("✅ Removed franchiseeFetched listener"))),super.detach()}destroy(){return console.log("💥 StoreLocator.destroy() called - component ID:",this.id),this._eventHandlers&&(this._eventHandlers.storeSearch&&(window.removeEventListener(i.StoreLocatorEvents.StoreSearch,this._eventHandlers.storeSearch),window.removeEventListener(i.StoreLocatorEvents.StoreSearchResults,this._eventHandlers.storeSearch),console.log("✅ Removed storeSearch listeners (destroy)")),this._eventHandlers.franchiseeFetched&&(window.removeEventListener(i.FranchiseeEvents.FranchiseeFetched,this._eventHandlers.franchiseeFetched),console.log("✅ Removed franchiseeFetched listener (destroy)")),this._eventHandlers=null),super.destroy()}normalizeValue(e,t={}){return super.normalizeValue(e,t)}getValue(){return super.getValue()}getValueAt(e){return super.getValueAt(e)}setValue(e,t={}){return super.setValue(e,t)}setValueAt(e,t,o={}){return super.setValueAt(e,t,o)}updateValue(e,t={}){return super.updateValue(e,t)}checkCondition(e,t){return super.checkCondition(e,t)}checkConditions(e){return super.checkConditions(e)}set visible(e){super.visible=e}get visible(){return super.visible}}Formio.use([{components:{rating:r,storeLocator:i}}])})();