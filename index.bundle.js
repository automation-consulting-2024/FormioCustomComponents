(()=>{"use strict";const e=[{type:"number",key:"numOfIcons",label:"Number of Icons",input:"true"},{type:"textfield",key:"filledColor",label:"Filled Color",input:"true"},{type:"textfield",key:"unfilledColor",label:"UnFilled Color",input:"true"},{type:"textfield",key:"iconHeight",label:"Icon Height",input:"true"},{type:"textfield",key:"iconWidth",label:"Icon Width",input:"true"},{type:"textarea",key:"icon",label:"Icon",input:!0},{key:"placeholder",ignore:!0}];function t(...t){return Formio.Components.baseEditForm([{key:"data",ignore:!0},{key:"display",components:e},{key:"validation",ignore:!0}],...t)}const o=Formio.Components.components.field;class n extends o{static editForm=t;static schema(...e){return o.schema({type:"rating",label:"rating",key:"rating",unfilledColor:"#ddd",filledColor:"yellow",numOfIcons:"5",iconHeight:"25px",iconWidth:"25px",icon:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n                 \t viewBox="0 0 47.94 47.94" xml:space="preserve">\n                 <path d="M26.285,2.486l5.407,10.956c0.376,0.762,1.103,1.29,1.944,1.412l12.091,1.757\n                 \tc2.118,0.308,2.963,2.91,1.431,4.403l-8.749,8.528c-0.608,0.593-0.886,1.448-0.742,2.285l2.065,12.042\n                 \tc0.362,2.109-1.852,3.717-3.746,2.722l-10.814-5.685c-0.752-0.395-1.651-0.395-2.403,0l-10.814,5.685\n                 \tc-1.894,0.996-4.108-0.613-3.746-2.722l2.065-12.042c0.144-0.837-0.134-1.692-0.742-2.285l-8.749-8.528\n                 \tc-1.532-1.494-0.687-4.096,1.431-4.403l12.091-1.757c0.841-0.122,1.568-0.65,1.944-1.412l5.407-10.956\n                 \tC22.602,0.567,25.338,0.567,26.285,2.486z"/>\n            </svg>'})}static get builderInfo(){return{title:"Rating",icon:"star",group:"basic",documentation:"/userguide/#textfield",weight:0,schema:n.schema()}}setIconProperties(){const e=(new DOMParser).parseFromString(this.component.icon,"text/xml");e.firstChild.style.fill=this.component.unfilledColor,e.firstChild.setAttribute("height",this.component.iconHeight),e.firstChild.setAttribute("width",this.component.iconWidth),this.component.icon=(new XMLSerializer).serializeToString(e.documentElement)}constructor(e,t,o){super(e,t,o)}init(){this.setIconProperties(),super.init()}get inputInfo(){return super.inputInfo}render(e){let t='<div ref="rating">';for(let e=0;e<this.component.numOfIcons;e++)t+=this.component.icon;return t+="</div>",super.render(t)}attach(e){function t(e,t){for(const o of e)o.style.fill=t}if(this.loadRefs(e,{rating:"single"}),!this.component.disabled){let e=this.refs.rating.children;for(let o=0;o<e.length;o++){let n=e[o];n.addEventListener("click",(()=>{t(e,this.component.unfilledColor),n.style.fill=this.component.filledColor;let r=n.previousElementSibling;for(;r;)r.style.fill=this.component.filledColor,r=r.previousElementSibling;this.updateValue(`${o+1}/${e.length}`)}))}}return super.attach(e)}detach(){return super.detach()}destroy(){return super.destroy()}normalizeValue(e,t={}){return super.normalizeValue(e,t)}getValue(){return super.getValue()}getValueAt(e){return super.getValueAt(e)}setValue(e,t={}){return super.setValue(e,t)}setValueAt(e,t,o={}){return super.setValueAt(e,t,o)}updateValue(e,t={}){return super.updateValue(e,t)}}const r=[{type:"textfield",key:"storeChangeBtnLabel",label:"Store Change Button Label",input:"true"},{type:"textfield",key:"storeInitialBtnLabel",label:"Store Initial Button Label",input:"true"},{type:"textfield",key:"storeClearBtnLabel",label:"Store Clear Button Label",input:"true"}];function s(...e){return Formio.Components.baseEditForm([{key:"data",ignore:!0},{key:"display",components:r},{key:"validation",ignore:!0}],...e)}const i=Formio.Components.components.field;class l extends i{static editForm=s;static Version="0.0.16-alpha";static StoreLocatorEvents={StoreSelected:"store.selected",StoreChanged:"store.changed",StoreSearch:"store.search",StoreSearchResults:"store.search.results"};static LocalStorageKeys={MageCacheStorage:"mage-cache-storage"};static MageCacheStorageKeys={StoreLocation:"store-location"};static Palette={Primary:{Main:"#3e87cb"},Grey:{Main:"#F7F8F8",Text:"#63666A"},White:"#ffffff"};static Styles={Container:{"background-color":l.Palette.Grey.Main,padding:"12px","border-radius":"8px",display:"flex","flex-direction":"row",position:"relative",gap:"8px"},IconContainer:{display:"none","align-items":"center"},Input:{outline:"none",border:"none",background:"transparent","flex-grow":1,color:l.Palette.Grey.Text,"box-shadow":"none !important"},StoreChangeBtn:{color:l.Palette.Primary.Main,display:"flex",cursor:"pointer","align-items":"center"},DropdownContainer:{position:"absolute",top:"calc(100% + 10px)","background-color":l.Palette.White,width:"100%",left:0,"z-index":100,"border-radius":"8px",padding:"12px","box-shadow":"0px 4px 12px rgba(0,0,0,0.25)",display:"none","flex-direction":"column",gap:"8px","max-height":"200px",overflow:"auto"},DropdownItem:{color:l.Palette.Primary.Main,"text-decoration":"underline",cursor:"pointer"}};static schema(...e){return i.schema({type:"storeLocator",label:"Store Locator",key:"storeLocator",storeChangeBtnLabel:"Change",storeInitialBtnLabel:"Use my current location",storeClearBtnLabel:"Clear"})}static get builderInfo(){return{title:"Store Locator",icon:"map",group:"basic",documentation:"/userguide/#textfield",weight:0,schema:l.schema()}}constructor(e,t,o){super(e,t,o)}init(){super.init()}get inputInfo(){return super.inputInfo}render(e){const t=l.stylesToCssString(l.Styles.Input),o=l.stylesToCssString(l.Styles.Container),n=l.stylesToCssString(l.Styles.DropdownContainer),r=l.stylesToCssString(l.Styles.StoreChangeBtn);let s=`\n    <div ref="storeLocator" style="${o}">\n      <span ref="iconContainer" style="${l.stylesToCssString(l.Styles.IconContainer)}">\n        <svg width="24" height="24" viewBox="0 0 24 24" style="fill: #0BAE1A" xmlns="http://www.w3.org/2000/svg">\n          <mask id="mask0_64_3413" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">\n            <rect y="-7.62939e-06" width="24" height="24" fill="#0BAE1A"/>\n          </mask>\n          <g mask="url(#mask0_64_3413)">\n            <path d="M10.6 13.8L8.425 11.625C8.24167 11.4417 8.01667 11.35 7.75 11.35C7.48333 11.35 7.25 11.45 7.05 11.65C6.86667 11.8333 6.775 12.0667 6.775 12.35C6.775 12.6333 6.86667 12.8667 7.05 13.05L9.9 15.9C10.0833 16.0833 10.3167 16.175 10.6 16.175C10.8833 16.175 11.1167 16.0833 11.3 15.9L16.975 10.225C17.1583 10.0417 17.25 9.81666 17.25 9.54999C17.25 9.28333 17.15 9.04999 16.95 8.84999C16.7667 8.66666 16.5333 8.57499 16.25 8.57499C15.9667 8.57499 15.7333 8.66666 15.55 8.84999L10.6 13.8ZM12 22C10.6167 22 9.31667 21.7373 8.1 21.212C6.88333 20.6873 5.825 19.975 4.925 19.075C4.025 18.175 3.31267 17.1167 2.788 15.9C2.26267 14.6833 2 13.3833 2 12C2 10.6167 2.26267 9.31666 2.788 8.09999C3.31267 6.88333 4.025 5.82499 4.925 4.92499C5.825 4.02499 6.88333 3.31233 8.1 2.78699C9.31667 2.26233 10.6167 1.99999 12 1.99999C13.3833 1.99999 14.6833 2.26233 15.9 2.78699C17.1167 3.31233 18.175 4.02499 19.075 4.92499C19.975 5.82499 20.6873 6.88333 21.212 8.09999C21.7373 9.31666 22 10.6167 22 12C22 13.3833 21.7373 14.6833 21.212 15.9C20.6873 17.1167 19.975 18.175 19.075 19.075C18.175 19.975 17.1167 20.6873 15.9 21.212C14.6833 21.7373 13.3833 22 12 22Z" fill="#0BAE1A"/>\n          </g>\n        </svg>\n      </span>\n      <input ref="storeInput" placeholder="${this.component.placeholder||"Search for a store"}" style="${t}"/>\n      <span ref="storeChangeBtn" style="${r}">${this.component.storeInitialBtnLabel||"Use my current location"}</span>\n      <div ref="dropdownContainer" style="${n}"></div>\n    </div>\n    `;return super.render(s)}static stylesToCssString(e,t={}){return Object.entries({...e,...t}).reduce(((e,[t,o])=>[e,`${t}: ${o}`].join("; ")),"")}getStoreFromLocalStorage(){const e=localStorage.getItem(l.LocalStorageKeys.MageCacheStorage);if(!e)return null;const t=JSON.parse(e)[l.MageCacheStorageKeys.StoreLocation];return t&&t.id?t:null}attach(e){this.loadRefs(e,{storeLocator:"single",dropdownContainer:"single",storeInput:"single",storeChangeBtn:"single",iconContainer:"single"});const t=this;let o=[],n=!1;if(this.component.disabled)return;const r=this.refs.storeInput,s=this.refs.dropdownContainer,i=this.refs.storeChangeBtn,a=this.refs.iconContainer,c=()=>{s.style=l.stylesToCssString(l.Styles.DropdownContainer,{display:"flex"})},d=()=>{s.style=l.stylesToCssString({display:"none"})},u=()=>{a.style=l.stylesToCssString({display:"none"})},p=()=>{const e=r.value&&""!==r.value.trim();i.innerText=e?n?t.component.storeChangeBtnLabel||"Change":t.component.storeClearBtnLabel||"Clear":t.component.storeInitialBtnLabel||"Use my current location"},g=e=>{const o=e.name;o&&(r.value=o,n=!0,i.style=l.stylesToCssString(l.Styles.StoreChangeBtn,{display:"flex"}),d(),a.style=l.stylesToCssString(l.Styles.IconContainer,{display:"flex"}),t.updateValue(o),p())};(()=>{const e=t.getStoreFromLocalStorage();e?(g(e),setTimeout((()=>{t.dispatchStoreSelectedEvent(e)}),100)):p()})();const h=e=>{if(console.log("~~~ filtering stores for searchTerm:",e),!o||0===o.length)return void console.log("~~~ No stores available to filter");const n=o.filter((t=>{const o=t.name.toLowerCase(),n=e.toLowerCase();return o.includes(n)}));if(c(),(()=>{for(;s.firstChild;)s.removeChild(s.firstChild)})(),0===n.length){const e=document.createElement("div");e.innerText="No stores found",e.style="color: #666; padding: 8px;",s.appendChild(e)}else{const e=n.map((e=>(e=>{const o=document.createElement("div"),n=document.createElement("a");return n.innerText=e.name,n.addEventListener("click",(function(o){o.preventDefault(),o.stopPropagation(),g(e),t.dispatchStoreSelectedEvent(e)})),n.style=l.stylesToCssString(l.Styles.DropdownItem),o.appendChild(n),o})(e)));s.append(...e)}};return i.addEventListener("click",(function(e){if(console.log("~~~ storeChangeBtn clicked"),e.preventDefault(),e.stopPropagation(),i.innerText===(t.component.storeClearBtnLabel||"Clear"))return r.value="",n=!1,p(),d(),void u();r.value="",r.focus(),n=!1;const o=t.getStoreFromLocalStorage(),s=t.userInput||o&&o.zip||"";t.dispatchStoreSearchEvent(s),c(),u(),p()})),r.addEventListener("input",(function(e){const r=e.target.value;console.log("~~~ input changed",r),t.userInput=r,n=!1,p(),t.getValue()!==r&&u(),o.length>0&&h(r),t.dispatchStoreSearchEvent(r)})),window.addEventListener(l.StoreLocatorEvents.StoreChanged,(e=>{console.log("~~~ store changed event received");const t=e.detail.store;console.log("~~~ store",t),g(t)})),window.addEventListener(l.StoreLocatorEvents.StoreSearchResults,(e=>{const t=e.detail.stores;console.log("store search results event received"),console.log("~~~ stores",t),o=t;const n=r.value||"";h(n)})),super.attach(e)}dispatchStoreSearchEvent(e){const t={detail:{postCode:e}},o=new window.CustomEvent(l.StoreLocatorEvents.StoreSearch,t);window.dispatchEvent(o)}dispatchStoreSelectedEvent(e){console.log("~~~ dispatching store selected event",e);const t=e.store_id,o=e.form_type;console.log("~~~ formType from selected store:",o),console.log("~~~ storeId from selected store:",t);const n={detail:{storeId:t,formType:o,store:e}};console.log("~~~ payload for event:",n);const r=new window.CustomEvent(l.StoreLocatorEvents.StoreSelected,n);window.dispatchEvent(r),this.updateStoreFormTypeField(o,t)}updateStoreFormTypeField(e,t){try{const o=this.root;if(!o)return void console.warn("StoreLocator: No root form found");const n=o.getComponent("storeFormType");n&&e&&(n.setValue(e),console.log("✅ Updated storeFormType to:",e));const r=o.getComponent("selectedStoreId");r&&t&&(r.setValue(t),console.log("✅ Updated selectedStoreId to:",t))}catch(e){console.error({message:"Error updating form fields",error:e})}}detach(){return super.detach()}destroy(){return super.destroy()}normalizeValue(e,t={}){return super.normalizeValue(e,t)}getValue(){return super.getValue()}getValueAt(e){return super.getValueAt(e)}setValue(e,t={}){return super.setValue(e,t)}setValueAt(e,t,o={}){return super.setValueAt(e,t,o)}updateValue(e,t={}){return super.updateValue(e,t)}checkCondition(e,t){return super.checkCondition(e,t)}checkConditions(e){return super.checkConditions(e)}set visible(e){super.visible=e}get visible(){return super.visible}}Formio.use([{components:{rating:n,storeLocator:l}}])})();