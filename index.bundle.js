(()=>{"use strict";const e=[{type:"number",key:"numOfIcons",label:"Number of Icons",input:"true"},{type:"textfield",key:"filledColor",label:"Filled Color",input:"true"},{type:"textfield",key:"unfilledColor",label:"UnFilled Color",input:"true"},{type:"textfield",key:"iconHeight",label:"Icon Height",input:"true"},{type:"textfield",key:"iconWidth",label:"Icon Width",input:"true"},{type:"textarea",key:"icon",label:"Icon",input:!0},{key:"placeholder",ignore:!0}];function t(...t){return Formio.Components.baseEditForm([{key:"data",ignore:!0},{key:"display",components:e},{key:"validation",ignore:!0}],...t)}const o=Formio.Components.components.field;class r extends o{static editForm=t;static schema(...e){return o.schema({type:"rating",label:"rating",key:"rating",unfilledColor:"#ddd",filledColor:"yellow",numOfIcons:"5",iconHeight:"25px",iconWidth:"25px",icon:'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"\n                 \t viewBox="0 0 47.94 47.94" xml:space="preserve">\n                 <path d="M26.285,2.486l5.407,10.956c0.376,0.762,1.103,1.29,1.944,1.412l12.091,1.757\n                 \tc2.118,0.308,2.963,2.91,1.431,4.403l-8.749,8.528c-0.608,0.593-0.886,1.448-0.742,2.285l2.065,12.042\n                 \tc0.362,2.109-1.852,3.717-3.746,2.722l-10.814-5.685c-0.752-0.395-1.651-0.395-2.403,0l-10.814,5.685\n                 \tc-1.894,0.996-4.108-0.613-3.746-2.722l2.065-12.042c0.144-0.837-0.134-1.692-0.742-2.285l-8.749-8.528\n                 \tc-1.532-1.494-0.687-4.096,1.431-4.403l12.091-1.757c0.841-0.122,1.568-0.65,1.944-1.412l5.407-10.956\n                 \tC22.602,0.567,25.338,0.567,26.285,2.486z"/>\n            </svg>'})}static get builderInfo(){return{title:"Rating",icon:"star",group:"basic",documentation:"/userguide/#textfield",weight:0,schema:r.schema()}}setIconProperties(){const e=(new DOMParser).parseFromString(this.component.icon,"text/xml");e.firstChild.style.fill=this.component.unfilledColor,e.firstChild.setAttribute("height",this.component.iconHeight),e.firstChild.setAttribute("width",this.component.iconWidth),this.component.icon=(new XMLSerializer).serializeToString(e.documentElement)}constructor(e,t,o){super(e,t,o)}init(){this.setIconProperties(),super.init()}get inputInfo(){return super.inputInfo}render(e){let t='<div ref="rating">';for(let e=0;e<this.component.numOfIcons;e++)t+=this.component.icon;return t+="</div>",super.render(t)}attach(e){function t(e,t){for(const o of e)o.style.fill=t}if(this.loadRefs(e,{rating:"single"}),!this.component.disabled){let e=this.refs.rating.children;for(let o=0;o<e.length;o++){let r=e[o];r.addEventListener("click",(()=>{t(e,this.component.unfilledColor),r.style.fill=this.component.filledColor;let n=r.previousElementSibling;for(;n;)n.style.fill=this.component.filledColor,n=n.previousElementSibling;this.updateValue(`${o+1}/${e.length}`)}))}}return super.attach(e)}detach(){return super.detach()}destroy(){return super.destroy()}normalizeValue(e,t={}){return super.normalizeValue(e,t)}getValue(){return super.getValue()}getValueAt(e){return super.getValueAt(e)}setValue(e,t={}){return super.setValue(e,t)}setValueAt(e,t,o={}){return super.setValueAt(e,t,o)}updateValue(e,t={}){return super.updateValue(e,t)}}const n=[{type:"textfield",key:"storeChangeBtnLabel",label:"Store Change Button Label",input:"true"},{type:"textfield",key:"storeInitialBtnLabel",label:"Store Initial Button Label",input:"true"},{type:"textfield",key:"storeClearBtnLabel",label:"Store Clear Button Label",input:"true"}],s=[{type:"checkbox",input:!0,key:"validate.required",label:"Required",tooltip:"A required field must be filled in before the form can be submitted.",weight:0},{type:"textfield",input:!0,key:"validate.customMessage",label:"Custom Error Message",placeholder:"Custom Error Message",tooltip:"Error message displayed if any error occurred.",weight:100}];function a(...e){return Formio.Components.baseEditForm([{key:"data",ignore:!0},{key:"display",components:n},{key:"validation",components:s}],...e)}const i=Formio.Components.components.field;class l extends i{static editForm=a;static Version="0.0.58-alpha";static StoreLocatorEvents={StoreSelected:"store.selected",StoreChanged:"store.changed",StoreSearch:"store.search",StoreSearchResults:"store.search.results"};static LocalStorageKeys={MageCacheStorage:"mage-cache-storage",AllFranchisees:"all-franchisees"};static MageCacheStorageKeys={StoreLocation:"store-location"};static FormComponentKeys={StoreFormType:"storeFormType",FranchiseeEmail:"franchiseeEmail",FranchiseeId:"franchiseeId"};static Palette={Primary:{Main:"#3e87cb"},Grey:{Main:"#F7F8F8",Text:"#63666A"},Warning:{Main:"#6F4400"},White:"#ffffff",IconColorBlack:"#382E2C"};static Styles={Container:{"background-color":l.Palette.Grey.Main,padding:"0px 12px","border-radius":"8px",display:"flex","flex-direction":"row",position:"relative",gap:"8px"},IconContainer:{display:"flex","align-items":"center",cursor:"pointer","flex-shrink":"0"},Input:{outline:"none",border:"none",background:"transparent","flex-grow":1,color:l.Palette.Grey.Text,"box-shadow":"none !important"},DropdownContainer:{position:"absolute",top:"calc(100% + 10px)","background-color":l.Palette.White,width:"100%",left:0,"z-index":100,"border-radius":"8px",padding:"12px","box-shadow":"0px 4px 12px rgba(0,0,0,0.25)",display:"none","flex-direction":"column",gap:"8px","max-height":"200px",overflow:"auto"},DropdownItem:{color:l.Palette.Primary.Main,"text-decoration":"underline",cursor:"pointer"},NoMatchingStoresContainer:{border:`2px solid ${l.Palette.Warning.Main}`,"border-radius":"8px",padding:"12px",margin:"4px",display:"flex","align-items":"center",gap:"8px"},WarningIcon:{display:"flex","flex-shrink":"0",width:"24px",height:"24px"},WarningMessageText:{color:l.Palette.Warning.Main,"font-size":"12px","font-weight":"500","line-height":"1.4"}};static schema(...e){return i.schema({type:"storeLocator",label:"Store Locator",key:"storeLocator",validate:{required:!1,customMessage:""}})}static get builderInfo(){return{title:"Store Locator",icon:"map",group:"basic",documentation:"/userguide/#textfield",weight:0,schema:l.schema()}}constructor(e,t,o){super(e,t,o)}init(){if(super.init(),!this.dataValue){const e=this.getStoreFromLocalStorage();e&&e.name&&(this.dataValue=e.name)}}get inputInfo(){return super.inputInfo}render(e){const t=l.stylesToCssString(l.Styles.Input),o=l.stylesToCssString(l.Styles.Container),r=l.stylesToCssString(l.Styles.DropdownContainer),n=l.stylesToCssString(l.Styles.IconContainer);let s=`\n    <div ref="storeLocator" style="${o}">\n      <input ref="storeInput" placeholder="${this.component.placeholder||"Search for a store"}" style="${t}"/>\n        <span ref="iconContainer" style="${n}">\n          \x3c!-- Icon will be updated dynamically: pin drop or close --\x3e\n        </span>\n      <div ref="dropdownContainer" style="${r}"></div>\n    </div>\n    `;return super.render(s)}static stylesToCssString(e,t={}){return Object.entries({...e,...t}).reduce(((e,[t,o])=>[e,`${t}: ${o}`].join("; ")),"")}getStoreFromLocalStorage(){const e=localStorage.getItem(l.LocalStorageKeys.MageCacheStorage);if(!e)return null;const t=JSON.parse(e)[l.MageCacheStorageKeys.StoreLocation];return t&&t.id?t:null}getAllFranchiseesFromLocalStorage(){try{const e=localStorage.getItem(l.LocalStorageKeys.AllFranchisees);return e?JSON.parse(e):[]}catch(e){return console.error({message:"Error reading franchisees from localStorage",error:e.message}),[]}}getFranchiseeByStoreId(e,t){if(!t||0===t.length)return null;const o=t.find((t=>t.storeId===e||t.store_id===e));return o?console.log("~~~ Found franchisee for storeId:",e,o):console.log("~~~ No franchisee found for storeId:",e),o||null}attach(e){this.loadRefs(e,{storeLocator:"single",dropdownContainer:"single",storeInput:"single",iconContainer:"single"});const t=this;let o=!1,r=null,n=t.getAllFranchiseesFromLocalStorage();if(this.component.disabled)return;this._eventHandlers=this._eventHandlers||{};const s=this.refs.storeInput,a=this.refs.dropdownContainer,i=this.refs.iconContainer,c=()=>{a.style=l.stylesToCssString({display:"none"})},d=()=>{i.style=l.stylesToCssString(l.Styles.IconContainer,{display:"flex"})},u=()=>{const e=s.value&&""!==s.value.trim();i.innerHTML=e?`\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M19 6.41L17.59 5L12 10.59L6.41 5L5 6.41L10.59 12L5 17.59L6.41 19L12 13.41L17.59 19L19 17.59L13.41 12L19 6.41Z" fill="${l.Palette.IconColorBlack}" />\n        </svg>\n      `:`\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <path d="M12 2C8.13 2 5 5.13 5 9C5 14.25 12 22 12 22C12 22 19 14.25 19 9C19 5.13 15.87 2 12 2ZM12 11.5C10.62 11.5 9.5 10.38 9.5 9C9.5 7.62 10.62 6.5 12 6.5C13.38 6.5 14.5 7.62 14.5 9C14.5 10.38 13.38 11.5 12 11.5Z" fill="${l.Palette.IconColorBlack}" />\n        </svg>\n        `};(()=>{const e=t.getStoreFromLocalStorage();if(!e)return void u();const r=e.id||e.store_id,a=t.getFranchiseeByStoreId(r,n),i=e.name;if(i&&(s.value=i,o=!0,d(),u(),t.updateValue(i),t.pristine=!1),a){const e=a.bmqFormType||a.bmq_form_type,o=a.email,r=a.id;console.log("~~~ franchisee data from localStorage:",{bmqFormType:e,email:o,id:r}),t.updateFormComponentValue(l.FormComponentKeys.StoreFormType,e),t.updateFormComponentValue(l.FormComponentKeys.FranchiseeEmail,o),t.updateFormComponentValue(l.FormComponentKeys.FranchiseeId,r),console.log("~~~ Updated dependent fields from localStorage store")}})();const p=e=>{console.log("~~~ stores from filter and display stores",e),a.style=l.stylesToCssString(l.Styles.DropdownContainer,{display:"flex"}),(()=>{for(;a.firstChild;)a.removeChild(a.firstChild)})();const r=Array.isArray(e)?e:[];if(0===r.length){const e=(()=>{const e=document.createElement("div");e.style=l.stylesToCssString(l.Styles.NoMatchingStoresContainer);const t=document.createElement("span");t.innerHTML='\n        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">\n          <mask id="mask0_1002_39163" style="mask-type:alpha" maskUnits="userSpaceOnUse" x="0" y="0" width="24" height="24">\n            <rect width="24" height="24" fill="#D9D9D9"/>\n          </mask>\n          <g mask="url(#mask0_1002_39163)">\n            <path d="M2.72187 21C2.33854 21 2.05521 20.8333 1.87188 20.5C1.68854 20.1667 1.68854 19.8333 1.87188 19.5L11.1219 3.5C11.3052 3.16667 11.5969 3 11.9969 3C12.3969 3 12.6885 3.16667 12.8719 3.5L22.1219 19.5C22.3052 19.8333 22.3052 20.1667 22.1219 20.5C21.9385 20.8333 21.6552 21 21.2719 21H2.72187ZM11.9969 10C11.7135 10 11.4762 10.0957 11.2849 10.287C11.0929 10.479 10.9969 10.7167 10.9969 11V14C10.9969 14.2833 11.0929 14.5207 11.2849 14.712C11.4762 14.904 11.7135 15 11.9969 15C12.2802 15 12.5179 14.904 12.7099 14.712C12.9012 14.5207 12.9969 14.2833 12.9969 14V11C12.9969 10.7167 12.9012 10.479 12.7099 10.287C12.5179 10.0957 12.2802 10 11.9969 10ZM11.9969 18C12.2802 18 12.5179 17.904 12.7099 17.712C12.9012 17.5207 12.9969 17.2833 12.9969 17C12.9969 16.7167 12.9012 16.4793 12.7099 16.288C12.5179 16.096 12.2802 16 11.9969 16C11.7135 16 11.4762 16.096 11.2849 16.288C11.0929 16.4793 10.9969 16.7167 10.9969 17C10.9969 17.2833 11.0929 17.5207 11.2849 17.712C11.4762 17.904 11.7135 18 11.9969 18Z" fill="#6F4400"/>\n          </g>\n        </svg>\n      ',t.style=l.stylesToCssString(l.Styles.WarningIcon);const o=document.createElement("span");return o.innerText="We didn't find any store matching the provided postcode/suburb. Please re-enter your postcode or suburb.",o.style=l.stylesToCssString(l.Styles.WarningMessageText),e.appendChild(t),e.appendChild(o),e})();a.appendChild(e)}else{const e=r.map((e=>(e=>{const r=document.createElement("div"),a=document.createElement("a");return a.innerText=e.name,a.addEventListener("click",(function(r){r.preventDefault(),r.stopPropagation(),(e=>{const r=e.name;r&&(s.value=r,o=!0,c(),d(),t.updateValue(r),u())})(e);const a=e.id||e.store_id,i=t.getFranchiseeByStoreId(a,n);if(i){const o=i.bmqFormType||i.bmq_form_type,r=i.email,n=i.id;e.bmq_form_type=o,e.bmqFormType=o,t.updateFormComponentValue(l.FormComponentKeys.StoreFormType,o),t.updateFormComponentValue(l.FormComponentKeys.FranchiseeEmail,r),t.updateFormComponentValue(l.FormComponentKeys.FranchiseeId,n)}else console.warn("⚠️ No franchisee found for store:",a);t.setLocalStorage(e),t.dispatchStoreSelectedEvent(e)})),a.style=l.stylesToCssString(l.Styles.DropdownItem),r.appendChild(a),r})(e)));a.append(...e)}};return i.addEventListener("click",(function(e){if(e.preventDefault(),e.stopPropagation(),o||""!==s.value)s.value="",o=!1,c(),t.updateValue(""),u();else{s.focus();const e="3000";t.dispatchStoreSearchEvent(e)}})),s.addEventListener("input",(function(e){const n=e.target.value;t.userInput=n,o=!1,u(),r&&clearTimeout(r),r=setTimeout((()=>{t.dispatchStoreSearchEvent(n)}),500)})),this._eventHandlers.StoreSearchResults=e=>{console.log("~~~ StoreSearchResults:",e.detail);const t=e.detail.stores;p(t)},window.addEventListener(l.StoreLocatorEvents.StoreSearchResults,this._eventHandlers.StoreSearchResults),super.attach(e)}dispatchStoreSearchEvent(e){const t={detail:{postCode:e}},o=new window.CustomEvent(l.StoreLocatorEvents.StoreSearch,t);window.dispatchEvent(o)}setLocalStorage(e){try{const t=e.store_id||e.id,o=localStorage.getItem(l.LocalStorageKeys.MageCacheStorage);let r=o?JSON.parse(o):{};r[l.MageCacheStorageKeys.StoreLocation]={...e,id:t},localStorage.setItem(l.LocalStorageKeys.MageCacheStorage,JSON.stringify(r))}catch(e){console.error({message:"Error setting store in localStorage",error:e.message})}}dispatchStoreSelectedEvent(e){console.log("~~~ dispatching store selected event",e);const t={detail:{storeId:e.store_id||e.id,bmqFormType:e.bmq_form_type||e.bmqFormType,store:e}};console.log("~~~ Final payload for store.selected event:",t);const o=new window.CustomEvent(l.StoreLocatorEvents.StoreSelected,t);window.dispatchEvent(o)}updateFormComponentValue(e,t){try{const o=this.root;if(!o)return void console.warn("StoreLocator: No root form found");const r=o.getComponent(e);r&&t?(r.setValue(t),console.log(`✅ Updated ${e} with value:`,t)):console.warn(`⚠️ Component ${e} not found or value is empty`)}catch(t){console.error({message:"Error updating form component",componentKey:e,error:t})}}detach(){return this._eventHandlers&&this._eventHandlers.StoreSearchResults&&window.removeEventListener(l.StoreLocatorEvents.StoreSearchResults,this._eventHandlers.StoreSearchResults),super.detach()}destroy(){return this._eventHandlers&&(this._eventHandlers.StoreSearchResults&&window.removeEventListener(l.StoreLocatorEvents.StoreSearchResults,this._eventHandlers.StoreSearchResults),this._eventHandlers=null),super.destroy()}normalizeValue(e,t={}){return super.normalizeValue(e,t)}getValue(){return super.getValue()}getValueAt(e){return super.getValueAt(e)}setValue(e,t={}){return super.setValue(e,t)}setValueAt(e,t,o={}){return super.setValueAt(e,t,o)}updateValue(e,t={}){if((null===e||""===e||void 0===e)&&t.resetValue){const t=this.getStoreFromLocalStorage();t&&t.name&&(e=t.name)}return super.updateValue(e,t)}checkCondition(e,t){return super.checkCondition(e,t)}checkConditions(e){return super.checkConditions(e)}set visible(e){super.visible=e}get visible(){return super.visible}}Formio.use([{components:{rating:r,storeLocator:l}}])})();